openapi: "3.0.0"
info:
  title: Thoth User API
  version: "0.6.0-dev"
servers:
  - url: "/api/v1"
paths:
  /image/metadata:
    post:
      tags: ["Image Analysis"]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: post_image_metadata
      summary: Get metadata for the given image
      parameters:
        - $ref: "#/components/parameters/image"
        - $ref: "#/components/parameters/registry_user"
        - $ref: "#/components/parameters/registry_password"
        - $ref: "#/components/parameters/verify_tls"
      responses:
        "200":
          description: Information about the given image.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ImageMetadataResponse"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"
        "403":
          description: If user is not authorized to pull image.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"

  /analyze:
    post:
      tags: ["Image Analysis"]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: post_analyze
      summary: Analyze the given image asynchronously.
      parameters:
        - $ref: "#/components/parameters/image"
        - $ref: "#/components/parameters/registry_user"
        - $ref: "#/components/parameters/registry_password"
        - name: environment_type
          in: query
          required: false
          description: >
            Type of environment (runtime or buildtime) which is being analyzed.
          schema:
            type: string
            enum:
              - buildtime
              - runtime
            default: runtime
        - name: origin
          in: query
          required: false
          description: >
            A remote where the image is being used. This is used for tracking as well as
            for automated reporting when results are available.
          schema:
            type: string
        - name: debug
          in: query
          required: false
          description: >
            Run the given analyzer in a verbose mode so developers can debug
            analyzer.
          schema:
            type: boolean
            default: false
        - $ref: "#/components/parameters/verify_tls"
        - name: force
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: >
            Do not use cached results, always run analysis.
      responses:
        "202":
          description: Successful response with analyzer id.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponse"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"

  /analyze/{analysis_id}:
    get:
      tags: ["Image Analysis"]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: get_analyze
      summary: Retrieve an analyzer result.
      parameters:
        - name: analysis_id
          in: path
          required: true
          description: Id of analysis that results should be retrieved.
          schema:
            type: string
      responses:
        "200":
          description: Analyzer result retrieved.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResultResponse"
        "202":
          description: Results are not ready yet.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisStatusResponse"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"
        "404":
          description: The given document does not exist.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"

  /analyze/by-hash/{image_hash}:
    get:
      tags: ["Image Analysis"]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: get_analyze_by_hash
      summary: Retrieve an analyzer result.
      parameters:
        - name: image_hash
          in: path
          required: true
          description: Image hash for identifying image (including hash type, now supported only "sha256").
          schema:
            type: string
      responses:
        "200":
          description: Analyzer result retrieved.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResultResponse"
        "202":
          description: Results are not ready yet.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisStatusResponse"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"
        "404":
          description: The given document does not exist.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"

  /analyze/{analysis_id}/log:
    get:
      tags: ["Image Analysis"]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: get_analyze_log
      summary: Show logs of an analysis.
      parameters:
        - $ref: "#/components/parameters/analysis_id"
      responses:
        "200":
          description: Successful response.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisLogResponse"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"
        "404":
          description: The given image analysis log does not exist.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"

  /analyze/{analysis_id}/status:
    get:
      tags: ["Image Analysis"]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: get_analyze_status
      summary: Show analysis status.
      parameters:
        - $ref: "#/components/parameters/analysis_id"
      responses:
        "200":
          description: Successful response.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisStatusResponse"
        "404":
          description: No analysis with the given id found.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"

  /provenance/python:
    post:
      tags: [Provenance]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: post_provenance_python
      summary: Check provenance of packages stated in an application stack.
      requestBody:
        required: true
        description: Pipfile and Pipfile.lock as used by pipenv.
        content:
          application/json:
            schema:
              x-body-name: application_stack
              $ref: "#/components/schemas/PythonStack"
      parameters:
        - name: origin
          in: query
          required: false
          description: >
            A repository where the application stack is used. This is used for tracking as well as
            for automated reporting when results are available.
          schema:
            type: string
        - name: debug
          in: query
          required: false
          description: >
            Run the provenance checker in a verbose mode so developers
            can debug it.
          schema:
            type: boolean
            default: false
        - name: force
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: >
            Do not use cached results, always run provenance checks.
      responses:
        "202":
          description: The provided files will be checked for provenance.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponse"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"

  /provenance/python/{analysis_id}:
    get:
      tags: [Provenance]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: get_provenance_python
      summary: Retrieve a provenance check result.
      parameters:
        - $ref: "#/components/parameters/analysis_id"
      responses:
        "200":
          description: Provenance report retrieved.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResultResponse"
        "202":
          description: Results are not ready yet.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisStatusResponse"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"
        "404":
          description: The given document does not exist.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"

  /provenance/python/{analysis_id}/log:
    get:
      tags: [Provenance]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: get_provenance_python_log
      summary: Show logs of a provenance checks.
      parameters:
        - $ref: "#/components/parameters/analysis_id"
      responses:
        "200":
          description: Successful response.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisLogResponse"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"
        "404":
          description: The given image analysis log does not exist.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"

  /provenance/python/{analysis_id}/status:
    get:
      tags: [Provenance]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: get_provenance_python_status
      summary: Show status of a provenance check.
      parameters:
        - name: analysis_id
          in: path
          required: true
          description: An id of requested provenance check.
          schema:
            type: string
      responses:
        "200":
          description: Successful response.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisStatusResponse"
        "404":
          description: No analysis with the given id found.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"

  /python-package-index:
    get:
      tags: [PythonPackages]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: list_python_package_indexes
      summary: List registered Python package indexes.
      responses:
        "200":
          description: Listing of available Python package indexes.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PythonPackageIndexes"

  /hardware:
    get:
      tags: [Hardware]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: list_hardware_environments
      summary: Retrieve a list of supported hardware environments
      parameters:
        - $ref: "#/components/parameters/page"
      responses:
        "200":
          description: A list of supported hardware environments.
          content:
            application/json:
              schema:
                type: object
                required:
                  - parameters
                  - hardware_environments
                properties:
                  parameters:
                    type: object
                    description: Parameters set by user.
                    required:
                      - page
                    properties:
                      page:
                        type: integer
                        description: Pagination.
                        example: 10
                  hardware_environments:
                    type: array
                    items:
                      type: object
                      description: Available hardware environment configurations.
                      required:
                        - cpu_cores
                        - cpu_family
                        - cpu_model
                        - cpu_model_name
                        - cpu_physical_cpus
                        - cpu_vendor
                        - gpu_cores
                        - gpu_memory_size
                        - gpu_model_name
                        - gpu_vendor
                        - ram_size
                      properties:
                        cpu_cores:
                          type: integer
                          description: Number of cores of the CPU.
                          example: 2
                          nullable: true
                        cpu_family:
                          type: integer
                          description: The CPU family.
                          example: 6
                          nullable: true
                        cpu_model:
                          type: integer
                          description: The CPU model.
                          example: 94
                          nullable: true
                        cpu_model_name:
                          type: string
                          description: The CPU model name.
                          example: "Intel"
                          nullable: true
                        cpu_physical_cpus:
                          type: integer
                          description: The CPU physical CPUs.
                          example: 6
                          nullable: true
                        cpu_vendor:
                          type: integer
                          description: The CPU vendor.
                          example: 1
                          nullable: true
                        gpu_cores:
                          type: integer
                          description: Number of cores of the GPU.
                          example: 8
                          nullable: true
                        gpu_memory_size:
                          type: integer
                          description: The GPU memory size.
                          example: 8
                          nullable: true
                        gpu_model_name:
                          type: string
                          description: The GPU model name.
                          example: "NVIDIA"
                          nullable: true
                        gpu_vendor:
                          type: string
                          description: The GPU vendor.
                          example: "Gigabyte"
                          nullable: true
                        ram_size:
                          type: integer
                          description: The RAM size.
                          example: 16
                          nullable: true
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"

  /advise/python:
    post:
      tags: [Advise]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: post_advise_python
      summary: Get advise for Python ecosystem.
      requestBody:
        required: true
        description: Specification of Python application stack with runtime specific information.
        content:
          application/json:
            schema:
              x-body-name: input
              $ref: "#/components/schemas/AdviseInput"
      parameters:
        - name: recommendation_type
          in: query
          description: Recommendation type.
          required: true
          schema:
            type: string
            enum:
              - stable
              - testing
              - latest
              - performance
              - security
            default: stable
        - name: count
          in: query
          description: Number of software stacks that should be returned.
          schema:
            type: integer
          required: false
        - name: limit
          in: query
          description: Limit number of software stacks scored.
          schema:
            type: integer
          required: false
        - name: origin
          in: query
          required: false
          description: >
            A repository where the application stack is used. This is used for tracking as well as
            for automated reporting when results are available.
          schema:
            type: string
        - name: source_type
          in: query
          required: false
          description: >
            A flag marking what Thoth integration is requesting adviser:
              - cli: Thamos CLI.
              - s2i: OpenShift's S2I (Source-to-Image) build.
              - github_app: Qeb-Hwt GitHub App.
              - kebechet: Kebechet Bot.
              - jupyter_notebook: Jupyter Notebook (nb-requirements).
          schema:
            type: string
            nullable: true
            enum:
              - cli
              - s2i
              - github_app
              - kebechet
              - jupyter_notebook
        - name: dev
          in: query
          required: false
          description: >
            Consider or do not consider development dependencies when resolving stacks.
          schema:
            type: boolean
            default: false
        - name: debug
          in: query
          required: false
          description: >
            Run the given adviser in a verbose mode so developers can debug it.
          schema:
            type: boolean
            default: false
        - name: force
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: >
            Do not use cached results, always run adviser.
        - name: github_event_type
          in: query
          required: false
          schema:
            type: string
          description: GitHub's event type.
        - name: github_check_run_id
          in: query
          required: false
          schema:
            type: integer
          description: GitHub's event id.
        - name: github_installation_id
          in: query
          required: false
          schema:
            type: integer
          description: GitHub's installation id.
        - name: github_base_repo_url
          in: query
          required: false
          schema:
            type: string
          description: URL of the GitHub repository containing the Pull Request.
      responses:
        "202":
          description: The adviser is scheduled.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponse"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"

  /s2i/python:
    get:
      tags: [s2i]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: list_s2i_python
      summary: Get available S2I base container images for Python applications.
      responses:
        "200":
          description: A list of available Python S2I.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/S2IPythonResponse"

  /advise/python/{analysis_id}/log:
    get:
      tags: [Advise]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: get_advise_python_log
      summary: Retrieve a adviser run log.
      parameters:
        - name: analysis_id
          in: path
          required: true
          description: An id of analysis for which log should be retrieved.
          schema:
            type: string
      responses:
        "200":
          description: Retrieved adviser log.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisLogResponse"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"
        "404":
          description: The given adviser log does not exist.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"

  /advise/python/{analysis_id}/status:
    get:
      tags: [Advise]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: get_advise_python_status
      summary: Show status of an adviser computing recommendations.
      parameters:
        - name: analysis_id
          in: path
          required: true
          description: An id of requested adviser run.
          schema:
            type: string
      responses:
        "200":
          description: Successful response.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisStatusResponse"
        "404":
          description: No analysis with the given id found.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"

  /advise/python/{analysis_id}:
    get:
      tags: [Advise]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: get_advise_python
      summary: Get computed adviser result based on its id.
      parameters:
        - name: analysis_id
          in: path
          required: true
          description: Advise id returned on advise request.
          schema:
            type: string
      responses:
        "200":
          description: >
            Computed pinned down stack with information based on
            requested requirements advise.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResultResponse"
        "202":
          description: Results are not ready yet.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisStatusResponse"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"
        "404":
          description: The given advise does not exist.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"

  /buildlog/{document_id}:
    get:
      tags: [Buildlogs]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: get_buildlog
      summary: Retrieve the given build log.
      parameters:
        - name: document_id
          in: path
          required: true
          schema:
            type: string
          description: Build log to be retrieved.
      responses:
        "200":
          description: Successful response.
        "400":
          description: On invalid request.
        "404":
          description: The given build log does not exist.

  /kebechet-webhook:
    post:
      tags: [Kebechet]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: schedule_kebechet_webhook
      summary: Schedule kebechet instance from webhook
      requestBody:
        required: true
        description: Body of a git service webhook
        content:
          application/json:
            schema:
              x-body-name: body
              $ref: "#/components/schemas/KebechetWebhookInput"
              additionalProperties: true
      responses:
        "202":
          description: Accepted
        "400":
          description: Invalid
        "501":
          description: Functionality not supported

  /qeb-hwt:
    post:
      tags: [GitHub]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: schedule_qebhwt_advise
      summary: Schedule Thamos advise for GitHub App.
      requestBody:
        required: true
        description: Thamos advise inputs.
        content:
          application/json:
            schema:
              x-body-name: input
              $ref: "#/components/schemas/QebHwtThamosAdviseInput"
      responses:
        "202":
          description: Successful response with analyzer id.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponse"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResponseError"

  /build-analysis:
    post:
      tags: [Build Analysis]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: post_build
      summary: Analyze the given build imagestream and log.
      requestBody:
        required: true
        description: Fill up the Build details such as output imagestream, base imagestream, and build log.
        content:
          application/json:
            schema:
              x-body-name: build_detail
              $ref: "#/components/schemas/Build"
      parameters:
        - name: base_registry_user
          in: query
          required: false
          description: >
            Registry user to be used for pulling images from registry.
          schema:
            type: string
        - name: base_registry_password
          in: query
          required: false
          description: >
            Registry password or token to be used for pulling images from
            source registry.
          schema:
            type: string
        - name: base_registry_verify_tls
          in: query
          required: false
          description: >
            Verify TLS certificates of registry from where images are
            pulled from during the build.
          schema:
            type: boolean
            default: true
        - name: output_registry_user
          in: query
          required: false
          description: >
            Registry user to be used for pulling images from registry.
          schema:
            type: string
        - name: output_registry_password
          in: query
          required: false
          description: >
            Registry password or token to be used for pulling images from
            destination registry.
          schema:
            type: string
        - name: output_registry_verify_tls
          in: query
          required: false
          description: >
            Verify TLS certificates of registry from where images are
            pulled to during the build.
          schema:
            type: boolean
            default: true
        - name: environment_type
          in: query
          required: false
          description: >
            Type of environment (runtime or buildtime) which is being analyzed.
          schema:
            type: string
            enum:
              - buildtime
              - runtime
            default: runtime
        - name: origin
          in: query
          required: false
          description: >
            A remote where the image is being used. This is used for tracking as well as
            for automated reporting when results are available.
          schema:
            type: string
        - name: debug
          in: query
          required: false
          description: >
            Run the given analyzer in a verbose mode so developers can debug
            analyzer.
          schema:
            type: boolean
            default: false
        - name: force
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: >
            Do not use cached results, always run analysis.
      responses:
        "202":
          description: Successful response with analyzer id.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BuildAnalysisResponse"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BuildAnalysisResponseError"

  /python/platform:
    get:
      tags: [PythonPackages]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: get_python_platform
      summary: Get supported platforms for Python ecosystem.
      responses:
        "200":
          description: A list of platforms supported for Python ecosystem.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PythonPlatforms"

  /python/package/dependencies:
    get:
      tags: [PythonPackages]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: get_python_package_dependencies
      parameters:
        - name: name
          in: query
          required: true
          description: Name of the Python Package.
          schema:
            type: string
            default: "tensorflow"
        - name: version
          in: query
          required: true
          description: Version of the Python Package.
          schema:
            type: string
            default: "2.0.0"
        - name: index
          in: query
          required: true
          description: Index url of the Python Package.
          schema:
            type: string
            default: "https://pypi.org/simple"
        - name: os_name
          in: query
          required: false
          description: Name of operating system to consider as environment where package is installed in.
          schema:
            type: string
        - name: os_version
          in: query
          description: Version of operating system to consider as environment where package is installed in.
          schema:
            type: string
        - name: python_version
          in: query
          description: Version of Python interpreter used to install the given package.
          schema:
            type: string
        - name: marker_evaluation_result
          in: query
          description: >
            Consider marker evaluation result for the given environment. If set to None, marker
            evaluation result is not taken into account.
          schema:
            type: boolean
            nullable: true
            default: null
      summary: >
        Get direct dependencies of Python libraries. If environment is provided,
        take into account environment markers that are evaluated during dependencies
        installation. If environment is not provided, any environment is considered.
      responses:
        "200":
          description: The number of Python packages in Thoth Knowledge Graph.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PythonPackageDependencies"
        "404":
          description: The given record does not exist.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PythonPackageDependenciesError"

  /python/packages/count:
    get:
      tags: [PythonPackages]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: get_python_package_versions_count
      summary: >
        Retrieve information from the Knowledge Graph with regards
        to total number of Python packages.
      parameters:
        - name: name
          in: query
          required: false
          description: Name of the Python Package.
          schema:
            type: string
            nullable: true
            default: null
            example: "tensorflow"
        - name: version
          in: query
          required: false
          description: Version of the Python Package.
          schema:
            type: string
            nullable: true
            default: null
            example: "2.0.0"
        - name: index
          in: query
          required: false
          description: Index url of the Python Package.
          schema:
            type: string
            nullable: true
            default: null
            example: "https://pypi.org/simple"
      responses:
        "200":
          description: The number of Python packages in Thoth Knowledge Graph.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PythonPackagesCountInfoResponse"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PythonPackagesCountInfoResponseError"
        "404":
          description: The given record does not exist.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PythonPackagesCountInfoResponseError"

  /python/package/versions:
    get:
      tags: [PythonPackages]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: list_python_package_versions
      summary: List versions of the given Python package.
      parameters:
        - name: name
          in: query
          required: true
          description: Name of the Python Package.
          schema:
            type: string
            default: "tensorflow"
        - name: page
          in: query
          required: false
          description: Page offset in pagination.
          schema:
            type: integer
            default: 0
      responses:
        "200":
          description: Listing of available Python versions.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PythonPackageVersionsResponse"
        "404":
          description: The given record does not exist.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PythonPackageVersionsResponseError"

  /python/package/metadata:
    get:
      tags: [PythonPackages]
      x-openapi-router-controller: thoth.user_api.api_v1
      operationId: get_package_metadata
      summary: >
        Retrieve metadata relative to a Python Package
        from the Knowledge Graph.
      parameters:
        - name: name
          in: query
          required: true
          description: Name of the Python Package.
          schema:
            type: string
            default: "tensorflow"
        - name: version
          in: query
          required: true
          description: Version of the Python Package.
          schema:
            type: string
            default: "2.0.0"
        - name: index
          in: query
          required: true
          description: Index url of the Python Package.
          schema:
            type: string
            default: "https://pypi.org/simple"
      responses:
        "200":
          description: A dict with metadata relative to the Python Package requested.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PythonPackageMetadataResponse"
        "400":
          description: On invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PythonPackageMetadataResponseError"
        "404":
          description: The given record does not exist.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PythonPackageMetadataResponseError"

components:
  parameters:
    image:
      name: image
      in: query
      required: true
      description: >
        Name of image - can also specify remote registry to pull
        image from.
      schema:
        type: string
    registry_user:
      name: registry_user
      in: query
      required: false
      description: >
        Registry user to be used for pulling images from registry.
      schema:
        type: string
    registry_password:
      name: registry_password
      in: query
      required: false
      description: >
        Registry password or token to be used for pulling images from
        registry.
      schema:
        type: string
    verify_tls:
      name: verify_tls
      in: query
      required: false
      description: >
        Verify TLS certificates of registry from where images are
        pulled from.
      schema:
        type: boolean
        default: true
    analysis_id:
      name: analysis_id
      in: path
      required: true
      description: An id of requested analysis.
      schema:
        type: string
    page:
      name: page
      in: query
      required: false
      description: Page offset in pagination.
      schema:
        type: integer
        default: 0
    environment_name:
      name: environment_name
      in: path
      required: true
      description: >
        Software environment name for run for which analyses should be retrieved.
      schema:
        format: path
        type: string

  schemas:
    Build:
      type: object
      properties:
        base_image:
          type: string
          nullable: true
          description: >
            Name of base image used by the s2i build.
          example: quay.io/thoth-station/s2i-thoth-ubi8-py38
        output_image:
          type: string
          nullable: true
          description: >
            Name of output image - can also specify remote registry to pull
            image from.
          example: quay.io/thoth-station/s2i-thoth-ubi8-py38
        build_log:
          type: object
          description: >
            A full build details along with the log.
          properties:
            log:
              type: string
              nullable: true
              description: >
                A full build or installation log that was output during image build.
              example: >
                Collecting tensorflow
                Downloading tensorflow-1.4.1-cp36-cp36m-manylinux1_x86_64.whl (41.2MB)
                Successfully installed tensorflow-1.4.1
            apiversion:
              type: string
              nullable: true
              description: >
                BuildLog api version.
              example: >
                "apis/build.openshift.io/v1/namespaces/$NAMESPACE/builds HTTP/1.1"
            kind:
              type: string
              nullable: true
              description: >
                Type of log.
              example: >
                "BuildLog"
            metadata:
              type: string
              nullable: true
              properties:
                annotations:
                  type: string
                  properties:
                    ? buildlog.thoth-station.ninja/corresponding-build-configuration
                    : type: string
                      description: >
                        Contains all particulars about the build log.
                      example: >
                        "apiVersion:build.openshift.io/v1"
    Log:
      type: object
      required:
        - "log"
      properties:
        log:
          type: string
          description: >
            A full build or installation log that was output during image build.
          example: >
            Collecting tensorflow
            Downloading tensorflow-1.4.1-cp36-cp36m-manylinux1_x86_64.whl (41.2MB)
            Successfully installed tensorflow-1.4.1
        apiversion:
          type: string
          description: >
            BuildLog api version.
          example: >
            "apis/build.openshift.io/v1/namespaces/$NAMESPACE/builds HTTP/1.1"
        kind:
          type: string
          description: >
            Type of log.
          example: >
            "BuildLog"
        metadata:
          type: string
          properties:
            annotations:
              type: string
              properties:
                buildlog.thoth-station.ninja/corresponding-build-configuration:
                  type: string
                  description: >
                    Contains all particulars about the build log.
                  example: >
                    "apiVersion:build.openshift.io/v1"
    PythonStack:
      type: object
      required:
        - "requirements"
        - "requirements_lock"
      properties:
        requirements:
          type: string
          minLength: 1
          description: Direct dependencies for the application stack.
          example: |
            [[source]]
            url = "https://pypi.python.org/simple"
            verify_ssl = true
            name = "pypi"

            [packages]
            daiquiri = "*"

            [dev-packages]
        requirements_lock:
          type: string
          description: Fully pinned down dependency stack.
          example: '{
            "_meta": {
            "hash": {
            "sha256": "fecd8a66514e1129f796d7a45a1f5b2f7733e3ae0ead487ca63752da680ab8e4"
            },
            "pipfile-spec": 6,
            "requires": {},
            "sources": [
            {
            "name": "pypi",
            "url": "https://pypi.python.org/simple",
            "verify_ssl": true
            }
            ]
            },
            "default": {
            "daiquiri": {
            "hashes": [
            "sha256:1c4942ef0d40920100162ede6024edd43734e40b8dca9b13ebaf4b52ea198457",
            "sha256:eb300dfddae43dfdb157938a854b1387298b8fb340d6ecb7b5ae867283af763e"
            ],
            "index": "pypi",
            "version": "==1.4.0"
            }
            },
            "develop": {}
            }'
        requirements_format:
          type: string
          description: >
            Lockfile format - defaults to pipenv if not explicitly specified.
          items:
            type: string
          enum:
            - pipenv
            - requirements
          example: pipenv
    RuntimeEnvironment:
      type: object
      description: Runtime environment description, see Thamos configuration for more info.
      additionalProperties: true
      properties:
        hardware:
          type: object
          description: Hardware configuration used.
        operating_system:
          type: object
          description: Operating system used.
          nullable: true
        python_version:
          type: string
          example: "3.6"
          description: Python version on which the application runs on.
          nullable: true
        cuda_version:
          type: string
          example: "9.0"
          description: Nvidia CUDA version which the application uses.
          nullable: true
        openblas_version:
          type: string
          example: "0.3.13"
          description: OpenBLAS version used, if any.
          nullable: true
        openmpi_version:
          type: string
          example: "4.1"
          description: Open MPI version used, if any.
          nullable: true
        cudnn_version:
          type: string
          example: "8"
          description: NVIDIA cuDNN version used, if any.
          nullable: true
        mkl_version:
          type: string
          example: "2021.1.1"
          description: IntelÂ® Math Kernel Library version used, if any.
          nullable: true
        platform:
          type: string
          example: "linux-x86_64"
          description: Platform used - corresponds to sysconfig.get_platform() call.
          nullable: true
        base_image:
          type: string
          example: "https://quay.io/repository/thoth-station/s2i-thoth-ubi8-py38:v0.23.1"
          description: A base container image used to run the application.
          nullable: true
        name:
          type: string
          example: "ubi:8-prod"
          description: User defined name of the runtime environment.
        ipython:
          type: object
          description: >
            Additional information captured when recommendations were requested for Jupyter Notebook environments.
    AdviseInput:
      type: object
      required:
        - application_stack
      properties:
        application_stack:
          $ref: "#/components/schemas/PythonStack"
        runtime_environment:
          $ref: "#/components/schemas/RuntimeEnvironment"
        library_usage:
          type: object
          description: Static analysis of libraries used within user's project.
          required:
            - version
            - report
          properties:
            version:
              type: string
            report:
              type: object
    ImageMetadataResponse:
      type: object
      description: Response information with image metadata.
      properties:
        name:
          type: string
          description: Name of the image with optional tag.
          example: "fedora"
        tag:
          type: string
          description: Tag of the image.
          example: "latest"
        digest:
          type: string
          description: Digest of the image.
          example: sha256:cfd8f071bf8da7a466748f522406f7ae5908d002af1b1a1c0dcf893e183e5b32''
        repo_tags:
          type: array
          items:
            type: string
            description: Tags available in the registry repository.
        created:
          type: string
          description: Image creation date and time.
          example: "2016-03-04T18:40:02.92155334Z"
        docker_version:
          type: string
          description: Version of Docker.
          example: "1.9.1"
        labels:
          type: object
          description: Image labels.
        architecture:
          type: string
          description: Target architecture of image.
          example: "amd64"
        os:
          type: string
          description: "Operating system identifier."
        layers:
          type: array
          items:
            type: string
            description: Digests of image layesrs.
      required:
        - name
        - tag
        - digest
        - repo_tags
        - created
        - docker_version
        - labels
        - architecture
        - os
        - layers
    BuildAnalysisResponse:
      type: object
      description: Response for a submitted build analysis.
      properties:
        base_image_analysis:
          type: object
          description: Response for a submitted analysis.
          nullable: true
          properties:
            analysis_id:
              type: string
              description: >
                An id of submitted analysis for checking its status and its results.
            cached:
              type: boolean
              description: >
                If set to true the given analysis was picked from cache.
        output_image_analysis:
          type: object
          description: Response for a submitted analysis.
          nullable: true
          properties:
            analysis_id:
              type: string
              description: >
                An id of submitted analysis for checking its status and its results.
            cached:
              type: boolean
              description: >
                If set to true the given analysis was picked from cache.
        buildlog_analysis:
          type: object
          description: Response for a submitted analysis.
          nullable: true
          properties:
            analysis_id:
              type: string
              description: >
                An id of submitted analysis for checking its status and its results.
            cached:
              type: boolean
              description: >
                If set to true the given analysis was picked from cache.
        buildlog_document_id:
          type: string
          description: Document identifier for the stored build log.
    AnalysisResponse:
      type: object
      description: Response for a submitted analysis.
      properties:
        analysis_id:
          type: string
          description: >
            An id of submitted analysis for checking its status and its results.
        parameters:
          type: object
          description: >
            Parameters echoed back to user (with default parameters if omitted).
        cached:
          type: boolean
          description: >
            If set to true the given analysis was picked from cache.
      required:
        - analysis_id
        - parameters
        - cached
    PythonPackageIndexes:
      type: array
      description: A listing of Python package indexes.
      items:
        type: object
        description: A Python package index.
        required:
          - url
          - warehouse_api_url
          - verify_ssl
        properties:
          url:
            type: string
            description: URL to the Python simple repository as described in PEP 503.
            example: http://pypi.org/simple
          warehouse_api_url:
            type: string
            description: URL to the warehouse API.
            example: https://pypi.org/pypi
            nullable: true
          verify_ssl:
            type: boolean
            description: Use secured connection to warehouse.
            example: true
    BuildAnalysisResponseError:
      type: object
      description: Error Response for a submitted build analysis.
      properties:
        base_image_analysis:
          type: object
          properties:
            error:
              type: string
              description: Error information for user.
            parameters:
              type: object
              description: Parameters echoed back to user for debugging.
        output_image_analysis:
          type: object
          properties:
            error:
              type: string
              description: Error information for user.
            parameters:
              type: object
              description: Parameters echoed back to user for debugging.
        build_log_analysis:
          type: object
          properties:
            error:
              type: string
              description: Error information for user.
            parameters:
              type: object
              description: Parameters echoed back to user for debugging.
      required:
        - base_image_analysis
        - output_image_analysis
        - build_log_analysis
    AnalysisResponseError:
      type: object
      required:
        - error
        - parameters
      properties:
        error:
          type: string
          description: Error information for user.
        parameters:
          type: object
          description: Parameters echoed back to user for debugging.
    AnalysisResultResponse:
      type: object
      description: Result of an analysis
      required:
        - metadata
        - result
      properties:
        metadata:
          type: object
          description: Metadata for analysis run.
          required:
            - analyzer
            - analyzer_version
            - arguments
            - datetime
            - distribution
            - hostname
            - python
          properties:
            analyzer:
              type: string
              description: Analyzer name which handled analysis.
            analyzer_version:
              type: string
              description: Version of analyzer handling analysis.
            arguments:
              type: object
              description: Arguments passed to analyzer.
            datetime:
              type: string
              description: Date and time of analysis end in ISO format.
            distribution:
              type: object
              description: >
                Information about environment in which the analysis
                was performed.
              required:
                - codename
                - id
                - like
                - version
                - version_parts
              properties:
                codename:
                  type: string
                  description: >
                    Codename of environment in which the analysis was perfomed.
                id:
                  type: string
                  description: >
                    Identifier of environment in which the analysis
                    was perfomed.
                like:
                  type: string
                  description: >
                    Similar environments in comparision to environment in
                    which the analysis was perfomed.
                version:
                  type: string
                  description: A string representation of environment version.
                version_parts:
                  type: object
                  description: >
                    Parts of version identifier of the analysing environment.
                  properties:
                    build_number:
                      type: string
                    major:
                      type: string
                    minor:
                      type: string
                  required:
                    - build_number
                    - major
                    - minor
            hostname:
              type: string
              description: Pod name where the analysis was done.
            python:
              type: object
              required:
                - api_version
                - implementation_name
                - major
                - minor
                - micro
                - releaselevel
                - serial
              properties:
                api_version:
                  type: integer
                implementation_name:
                  type: string
                  example: cpython
                major:
                  type: integer
                micro:
                  type: integer
                minor:
                  type: integer
                releaselevel:
                  type: string
                  example: final
                serial:
                  type: integer
        result:
          type: object
          description: Actual result of an analysis run.
    AnalysisListingResponse:
      type: object
      description: Listing of available results.
      required:
        - result
        - parameters
      properties:
        result:
          type: array
          description: List of available analysis ids.
          items:
            type: string
            description: Analysis id that is used as a document id.
        parameters:
          type: object
          description: Parameters echoed back to user.
    AnalysisStatusResponse:
      type: object
      description: Information about the current analysis status.
      required:
        - parameters
        - status
      properties:
        status:
          type: object
          description: Status information about the analysis run.
          required:
            - finished_at
            - reason
            - started_at
            - state
          properties:
            finished_at:
              type: string
              description: >
                Datetime in ISO format informing about when the analysis
                has finished.
              nullable: true
            reason:
              type: string
              description: Reasoning on finished run.
              nullable: true
            started_at:
              type: string
              nullable: true
              description: >
                Datetime in ISO format informing about when the analysis
                has started.
            state:
              type: string
              example: running
        parameters:
          type: object
          description: Parameters echoed back to user for debugging.

    S2IPythonResponse:
      type: object
      required:
        - s2i
      properties:
        s2i:
          type: array
          items:
            type: object
            required:
              - thoth_s2i
              - thoth_s2i_name
              - thoth_s2i_version
              - analysis_id
            properties:
              thoth_s2i:
                type: string
                description: Full qualifier of Thoth's s2i.
                nullable: false
                example: quay.io/thoth-station/s2i-thoth-ubi8-py38:v1.0.0
              thoth_s2i_image_name:
                type: string
                description: Name of the Thoth s2i.
                nullable: false
                example: quay.io/thoth-station/s2i-thoth-ubi8-py38
              thoth_s2i_image_version:
                type: string
                description: Version of the Thoth s2i.
                nullable: false
                example: "1.0.0"
              analysis_id:
                type: string
                description: Container image analysis id.
                nullable: false
                example: package-extract-foo

    AnalysisLogResponse:
      type: object
      required:
        - log
        - parameters
      properties:
        log:
          type: string
          description: Analyzer logs printed to stdout/stderr as a plain text.
          nullable: true
        parameters:
          type: object
          description: Parameters echoed back to user for debugging.
    PythonPackagesCountInfoResponse:
      type: object
      required:
        - count
      properties:
        count:
          type: integer
          description: Total number of Python packages.
    PythonPackagesCountInfoResponseError:
      type: object
      required:
        - error
        - parameters
      properties:
        error:
          type: string
          description: Error information for user.
        parameters:
          type: object
          description: Parameters echoed back to user for debugging.

    PythonPackageVersionsResponse:
      type: object
      required:
        - versions
      properties:
        versions:
          type: array
          items:
            type: object
            required:
              - package_name
              - package_version
              - index_url
            properties:
              package_name:
                type: string
                nullable: false
                description: Name of the package.
                example: tensorflow
              package_version:
                type: string
                nullable: false
                description: Version of the package.
                example: "2.0.0"
              index_url:
                type: string
                nullable: false
                description: Source index URL of the package.
                example: "https://pypi.org/simple"

    PythonPackageMetadataResponse:
      type: object
      required:
        - author
        - author_email
        - classifier
        - download_url
        - home_page
        - keywords
        - license
        - maintainer
        - maintainer_email
        - metadata_version
        - name
        - platform
        - requires_dist
        - summary
        - version
        - requires_python
        - description_content_type
        - project_url
        - provides_extra
      properties:
        author:
          type: string
          nullable: true
          description: A string containing the authorâs name.
        author_email:
          type: string
          nullable: true
          description: A string containing the authorâs e-mail address.
        classifier:
          type: string
          nullable: true
          description: Each entry is a string giving a single classification value for the distribution.
        download_url:
          type: string
          nullable: true
          description: A string containing the URL from which this version of the distribution can be downloaded.
        home_page:
          type: string
          nullable: true
          description: A string containing the URL for the distributionâs home page.
        keywords:
          type: string
          nullable: true
          description: >
            A list of additional keywords to be used to assist
            searching for the distribution in a larger catalog.
        license:
          type: string
          nullable: true
          description: Text indicating the license covering the distribution.
        maintainer:
          type: string
          nullable: true
          description: >
            A string containing the maintainerâs name at a minimum;
            additional contact information may be provided.
        maintainer_email:
          type: string
          nullable: true
          description: A string containing the maintainerâs e-mail address.
        metadata_version:
          type: string
          nullable: true
          description: Version of the file format.
        name:
          type: string
          nullable: true
          description: Name of the distribution.
        platform:
          type: string
          nullable: true
          description: A Platform specification describing an operating system supported by the distribution.
        requires_dist:
          type: string
          nullable: true
          description: >
            Each entry contains a string naming some
            other distutils project required by this distribution.
        summary:
          type: string
          nullable: true
          description: A one-line summary of what the distribution does.
        version:
          type: string
          nullable: true
          description: version of the distribution.
        requires_python:
          type: string
          nullable: true
          description: Python requirements for the distribution.
        description_content_type:
          type: string
          nullable: true
          description: Content-Type of description text.
        project_url:
          type: string
          nullable: true
          description: URL to project.
        provides_extra:
          type: string
          nullable: true
          description: Provided extra of the distribution.
    PythonPackageVersionsResponseError:
      type: object
      required:
        - error
        - parameters
      properties:
        error:
          type: string
          description: Error information for user.
        parameters:
          type: object
          description: Parameters echoed back to user for debugging.
    PythonPackageMetadataResponseError:
      type: object
      required:
        - error
        - parameters
      properties:
        error:
          type: string
          description: Error information for user.
        parameters:
          type: object
          description: Parameters echoed back to user for debugging.
    KebechetWebhookInput:
      type: object
      description: Webhook payload from Github event.
    QebHwtThamosAdviseInput:
      type: object
      required:
        - github_event_type
        - github_check_run_id
        - github_installation_id
        - github_base_repo_url
        - github_head_repo_url
        - origin
        - revision
      properties:
        github_event_type:
          type: string
          description: Type of GitHub event.
        github_check_run_id:
          type: integer
          description: ID of the check-run that shall carry the thamos advise.
        github_installation_id:
          type: integer
          description: GitHub App Installation ID.
        github_base_repo_url:
          type: string
          description: URL of the GitHub repository containing the Pull Request.
        github_head_repo_url:
          type: string
          description: URL of the Pull Request's head commit.
        origin:
          type: string
          description: Origin of the repo where the Pull Request was opened.
        revision:
          type: string
          description: sha of the Pull Request's head commit.
    PythonPlatforms:
      type: object
      description: A listing of available platforms.
      required:
        - s2i
      properties:
        s2i:
          type: array
          items:
            type: string
            description: Platform information.
            example: linux-x86_64
    PythonPackageDependencies:
      type: array
      items:
        type: object
        description: Dependency information.
        required:
          - environment_marker
          - extra
          - name
          - version
        properties:
          environment_marker:
            type: string
            nullable: true
          extra:
            type: string
            nullable: true
          name:
            type: string
          version:
            type: string
    PythonPackageDependenciesError:
      type: object
      required:
        - error
        - parameters
      properties:
        error:
          type: string
          description: Error information for user.
        parameters:
          type: object
          description: Parameters echoed back to user for debugging.

  headers:
    xPage:
      schema:
        type: integer
        description: Current Page
    xPageSize:
      schema:
        type: integer
        description: Page Size
    xTotalPages:
      schema:
        type: integer
        description: Total Pages
